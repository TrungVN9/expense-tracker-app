@startuml

' Style and layout
skinparam classAttributeIconSize 0
skinparam linetype ortho

left to right direction

package "DTOs (Data Transfer Objects)" {
    class AuthResponse
    class SignupRequest
    class LoginRequest
    class BudgetResponse
    class TransactionRequest
    class TransferRequest
    class AmountRequest
    class InterestProjectionEntry
    class SavingTransactionResponse
    class SavingRequest
    class SavingResponse
    class TransactionDTO

}

' Packages for organization
package "Controllers (API Layer)" {
    class AuthController
    class BillController
    class BudgetController
    class TransactionController
    class UserController
    class SavingController
}

package "Services (Business Logic)" {
    class AuthService <<Facade>>
    interface UserDetailsService
    class CustomerUserDetailsService <<Strategy>>
    CustomerUserDetailsService --|> UserDetailsService
    class TransactionService <<Facade>>
    class SavingService <<Facade>>
}

package "Repositories (Data Access)" {
    interface Repository <<interface>>
    interface BillRepository
    interface BudgetRepository
    interface CustomerRepository
    interface TransactionRepository
    interface SavingRepository
    interface SavingTransactionRepository
    BillRepository --|> Repository
    BudgetRepository --|> Repository
    CustomerRepository --|> Repository
    TransactionRepository --|> Repository
    SavingRepository --|> Repository
    SavingTransactionRepository --|> Repository
}

' 1. Controller -> Service (Strict Layering)
AuthController --> AuthService
BillController --> BillRepository
BudgetController --> BudgetRepository
BudgetController --> TransactionRepository
TransactionController --> TransactionService
UserController --> UserDetailsService
UserController --> CustomerRepository
SavingController --> SavingService
SavingController --> SavingTransactionRepository

' 2. Service -> Repository
AuthService --> CustomerRepository
CustomerUserDetailsService --> CustomerRepository
TransactionService --> TransactionRepository
TransactionService --> CustomerRepository
SavingService --> SavingRepository
SavingService --> SavingTransactionRepository

package "Models (Domain Objects)" {
    class Bill
    class Budget
    class Customer
    class Transaction
    class Saving
    class SavingTransaction
}

package "Securities (Cross-Cutting Concern)" {
    class JwtAuthFilter <<TemplateMethod>>
    class OncePerRequestFilter <<abstract>>
    JwtAuthFilter --|> OncePerRequestFilter
    class JwtUtil <<Singleton>>
    class SecurityConfig
}

' Repository -> Models
BillRepository -- Bill
BudgetRepository -- Budget
CustomerRepository -- Customer
TransactionRepository -- Transaction
SavingRepository -- Saving
SavingTransactionRepository -- SavingTransaction

' Controller -> DTOs
AuthController -- AuthResponse
AuthController -- SignupRequest
AuthController -- LoginRequest
BudgetController -- BudgetResponse
TransactionController -- TransactionRequest
TransactionController -- TransactionDTO
SavingController -- SavingRequest
SavingController -- SavingResponse
SavingController -- SavingTransactionResponse
SavingController -- TransferRequest
SavingController -- AmountRequest
SavingController -- InterestProjectionEntry

' Security (Singleton Pattern)
SecurityConfig --> JwtAuthFilter
JwtAuthFilter --> JwtUtil : uses (Singleton)
JwtAuthFilter --> UserDetailsService : uses (Strategy)
SecurityConfig --> JwtAuthFilter : registers filter


' Model Relationships
Customer "1" -- "*" Bill
Customer "1" -- "*" Budget
Customer "1" -- "*" Transaction
Customer "1" -- "*" Saving
Saving "1" -- "*" SavingTransaction

@enduml
